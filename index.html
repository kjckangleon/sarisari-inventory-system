<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Item List Manager</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, button, label { padding: 5px; margin: 5px; display: block; }
    #item-list { margin-top: 20px; }
    li { margin-bottom: 10px; }
    img { max-width: 100px; max-height: 100px; display: block; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Item List</h1>

  <!-- Manual Input -->
  <h2>Manually Add Item</h2>
  <form id="manual-form">
    <input type="text" id="manual-name" placeholder="Item Name" required />
    <input type="number" id="manual-price" placeholder="Price" required />
    <input type="number" id="manual-stock" placeholder="Stock" required />
    <input type="text" id="manual-code" placeholder="Barcode (optional)" />
    <input type="file" id="manual-image" accept="image/*" />
    <button type="submit">Add Item</button>
  </form>

  <!-- Barcode Input with Camera -->
  <h2>Scan Barcode with Camera</h2>
  <video id="barcode-scanner" width="300" height="200" style="border:1px solid #ccc;"></video>

  <!-- Item List -->
  <div id="item-list">
    <h2>Items</h2>
    <ul id="items-ul"></ul>
  </div>

  <script type="module">
    import { BrowserMultiFormatReader } from 'https://cdn.jsdelivr.net/npm/@zxing/library@latest/esm/index.min.js';

    const itemList = document.getElementById('items-ul');
    let items = JSON.parse(localStorage.getItem('items')) || [];

    function saveItems() {
      localStorage.setItem('items', JSON.stringify(items));
    }

    function renderItems() {
      itemList.innerHTML = '';
      items.forEach((item, index) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <strong>${item.name}</strong><br>
          Price: â‚±${item.price} | Stock: ${item.stock} | Barcode: ${item.barcode || 'N/A'}<br>
          ${item.image ? `<img src="${item.image}" alt="${item.name}" />` : ''}
          <button onclick="deleteItem(${index})">Delete</button>
        `;
        itemList.appendChild(li);
      });
    }

    window.deleteItem = function(index) {
      if (confirm('Are you sure you want to delete this item?')) {
        items.splice(index, 1);
        saveItems();
        renderItems();
      }
    };

    document.getElementById('manual-form').addEventListener('submit', async function(e) {
      e.preventDefault();
      const name = document.getElementById('manual-name').value.trim();
      const price = parseFloat(document.getElementById('manual-price').value);
      const stock = parseInt(document.getElementById('manual-stock').value);
      const barcode = document.getElementById('manual-code').value.trim();
      const imageFile = document.getElementById('manual-image').files[0];
      let imageUrl = '';

      if (imageFile) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          imageUrl = evt.target.result;
          addItem({ name, price, stock, barcode, image: imageUrl });
        };
        reader.readAsDataURL(imageFile);
      } else {
        addItem({ name, price, stock, barcode, image: '' });
      }

      e.target.reset();
    });

    function addItem(item) {
      items.push(item);
      saveItems();
      renderItems();
    }

    function startCameraScan() {
      const codeReader = new BrowserMultiFormatReader();
      codeReader.decodeFromVideoDevice(null, 'barcode-scanner', (result, err) => {
        if (result) {
          const scanned = result.getText();
          const found = items.find(i => i.barcode === scanned);
          if (!found) {
            const name = prompt('Item name for scanned barcode:');
            const price = prompt('Price:');
            const stock = prompt('Stock:');
            if (name && price && stock) {
              addItem({ name, price: parseFloat(price), stock: parseInt(stock), barcode: scanned, image: '' });
            }
          } else {
            alert(`Already exists: ${found.name}`);
          }
        }
      });
    }

    startCameraScan();
    renderItems();
  </script>
</body>
</html>
