<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Item List Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@latest"></script>
  </head>
  <body class="bg-gray-50 min-h-screen p-6 font-sans">
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md p-6">
      <h1 class="text-3xl font-bold mb-4">ğŸ“¦ Item List Manager</h1>

      <!-- Manual Input -->
      <section class="mb-6">
        <h2 class="text-xl font-semibold mb-2">â• Add Item</h2>
        <form id="manual-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <input type="text" id="manual-name" placeholder="Item Name" required class="input input-bordered p-2 border rounded" />
          <input type="number" id="manual-price" placeholder="Price" required class="input input-bordered p-2 border rounded" />
          <input type="number" id="manual-stock" placeholder="Stock" required class="input input-bordered p-2 border rounded" />
          <input type="text" id="manual-code" placeholder="Barcode (optional)" class="input input-bordered p-2 border rounded" />
          <input type="file" id="manual-image" accept="image/*" class="col-span-full" />
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded col-span-full">Add Item</button>
        </form>
      </section>

      <!-- Barcode Input with Camera -->
      <section class="mb-6">
        <h2 class="text-xl font-semibold mb-2">ğŸ“· Scan Barcode with Camera</h2>
        <button id="start-scan" class="mb-2 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">Start Camera Scan</button>
        <video id="barcode-scanner" class="w-full max-w-md border rounded-md hidden" autoplay muted playsinline></video>
        <p id="scan-status" class="text-gray-600 mt-2"></p>
      </section>

      <!-- Find by Barcode -->
      <section class="mb-6">
        <h2 class="text-xl font-semibold mb-2">ğŸ” Find Item by Barcode</h2>
        <input type="text" id="search-barcode" placeholder="Enter or scan barcode" class="input input-bordered p-2 border rounded w-full max-w-md" />
        <div id="search-result" class="mt-4"></div>
      </section>

      <!-- Item List -->
      <section>
        <h2 class="text-xl font-semibold mb-2">ğŸ“‹ Item List</h2>
        <ul id="items-ul" class="space-y-4"></ul>
      </section>
    </div>

    <script>
      const itemList = document.getElementById('items-ul');
      const searchInput = document.getElementById('search-barcode');
      const searchResult = document.getElementById('search-result');
      const startScanBtn = document.getElementById('start-scan');
      const videoElement = document.getElementById('barcode-scanner');
      const scanStatus = document.getElementById('scan-status');
      let items = JSON.parse(localStorage.getItem('items')) || [];
      let codeReader;

      function saveItems() {
        localStorage.setItem('items', JSON.stringify(items));
      }

      function renderItems() {
        itemList.innerHTML = '';
        items.forEach((item, index) => {
          const li = document.createElement('li');
          li.className = 'bg-white p-4 rounded shadow border';
          li.innerHTML = `
            <div class="flex items-center gap-4">
              ${item.image ? `<img src="${item.image}" alt="${item.name}" class="w-24 h-24 object-cover rounded" />` : ''}
              <div class="flex-1">
                <h3 class="font-bold text-lg">${item.name}</h3>
                <p>Price: â‚±${item.price}</p>
                <p>Stock: ${item.stock}</p>
                <p>Barcode: ${item.barcode || 'N/A'}</p>
              </div>
              <button onclick="editItem(${index})" class="bg-yellow-400 hover:bg-yellow-500 text-black px-3 py-1 rounded">Edit</button>
              <button onclick="deleteItem(${index})" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded">Delete</button>
            </div>
          `;
          itemList.appendChild(li);
        });
      }

      window.deleteItem = function(index) {
        if (confirm('Are you sure you want to delete this item?')) {
          items.splice(index, 1);
          saveItems();
          renderItems();
        }
      };

      window.editItem = function(index) {
        const item = items[index];
        const name = prompt('Edit Name:', item.name);
        const price = prompt('Edit Price:', item.price);
        const stock = prompt('Edit Stock:', item.stock);
        const barcode = prompt('Edit Barcode:', item.barcode);
        if (name && price && stock) {
          items[index] = { ...item, name, price: parseFloat(price), stock: parseInt(stock), barcode };
          saveItems();
          renderItems();
        }
      };

      document.getElementById('manual-form').addEventListener('submit', async function (e) {
        e.preventDefault();
        const name = document.getElementById('manual-name').value.trim();
        const price = parseFloat(document.getElementById('manual-price').value);
        const stock = parseInt(document.getElementById('manual-stock').value);
        const barcode = document.getElementById('manual-code').value.trim();
        const imageFile = document.getElementById('manual-image').files[0];
        let imageUrl = '';

        if (imageFile) {
          const reader = new FileReader();
          reader.onload = function (evt) {
            imageUrl = evt.target.result;
            addItem({ name, price, stock, barcode, image: imageUrl });
          };
          reader.readAsDataURL(imageFile);
        } else {
          addItem({ name, price, stock, barcode, image: '' });
        }

        e.target.reset();
      });

      function addItem(item) {
        items.push(item);
        saveItems();
        renderItems();
      }

      async function startCameraScan() {
        scanStatus.textContent = 'Initializing camera...';
        videoElement.classList.remove('hidden');

        try {
          codeReader = new ZXing.BrowserMultiFormatReader();
          await codeReader.decodeFromVideoDevice(null, videoElement, (result, err) => {
            if (result) {
              scanStatus.textContent = `Scanned barcode: ${result.getText()}`;
              const scanned = result.getText();
              const found = items.find(i => i.barcode === scanned);
              if (!found) {
                const name = prompt('Item name for scanned barcode:');
                const price = prompt('Price:');
                const stock = prompt('Stock:');
                if (name && price && stock) {
                  addItem({ name, price: parseFloat(price), stock: parseInt(stock), barcode: scanned, image: '' });
                }
              } else {
                alert(`Already exists: ${found.name}`);
              }
            }
          });
          scanStatus.textContent = 'Scanning...';
        } catch (err) {
          scanStatus.textContent = 'Error accessing camera. Please allow permission or use a compatible device.';
          console.error(err);
        }
      }

      searchInput.addEventListener('input', function() {
        const query = searchInput.value.trim();
        if (query === '') {
          searchResult.innerHTML = '';
          return;
        }
        const item = items.find(i => i.barcode === query);
        if (item) {
          searchResult.innerHTML = `
            <div class="p-4 border rounded bg-green-50">
              <h3 class="font-bold text-lg">${item.name}</h3>
              <p>Price: â‚±${item.price}</p>
              <p>Stock: ${item.stock}</p>
              <p>Barcode: ${item.barcode}</p>
              ${item.image ? `<img src="${item.image}" alt="${item.name}" class="w-32 h-32 mt-2 object-cover rounded" />` : ''}
            </div>
          `;
        } else {
          searchResult.innerHTML = '<p class="text-red-600">Item not found.</p>';
        }
      });

      startScanBtn.addEventListener('click', startCameraScan);
      renderItems();
    </script>
  </body>
</html>
